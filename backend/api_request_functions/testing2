require('dotenv').config();
const apiID = process.env.AZUNA_ID;
const apiKEY = process.env.AZUNA_KEY;
const axios = require('axios');


function getAdunaListing(city, category){
  console.log(apiID + " and " + apiKEY)
  console.log("city: " + city + "category: " + category)
  let constructedURL = `http://api.adzuna.com/v1/api/property/gb/search/1/?category=${category}&app_id=${apiID}&app_key=${apiKEY}&results_per_page=10&where=${city}`;
  console.log("constructed URL: " + constructedURL)

  const promise = new Promise((resolve, reject) => {
    axios.get(constructedURL).then(results => {
      console.log("axios returned results: " + results);
      return results;
    })
    .catch(error => console.log("catch " + error)),function(error, response, status){
        if (error){
          console.log("fetch error: "+ error);
          reject(error);
        }
        else {
          console.log(response);
          resolve(response);
        }
      }
      });

  return promise; // promise
}

module.exports = getAdunaListing;
